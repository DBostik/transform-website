---
/**
 * HighLevel Contact Us Form Handler - CLEAN VERSION
 * 
 * No iframes, no embeds - just pure form submission to HighLevel.
 * This avoids all cross-origin issues and HighLevel JavaScript errors.
 * 
 * Used for: Contact page form
 * Fields: Name, Phone, Email, Message
 */
---

<script is:inline>
  (function() {
    'use strict';
    
    // HighLevel form endpoint
    const FORM_ID = 'u8SRmwrjxnx9rWGuQGKb';
    const FORM_ENDPOINT = `https://api.leadconnectorhq.com/widget/form/${FORM_ID}`;
    
    console.log('[GHL] Contact Us handler loaded');

    function setupContactForm() {
      const form = document.getElementById('contact-us-form');
      
      if (!form) {
        console.log('[GHL] Contact form not found on this page');
        return;
      }

      console.log('[GHL] Setting up contact-us-form');

      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log('[GHL] Contact form submitted, processing...');

        const submitBtn = form.querySelector('button[type="submit"]');
        const nameInput = form.querySelector('input[name="name"]');
        const emailInput = form.querySelector('input[name="email"]');
        const phoneInput = form.querySelector('input[name="phone"]');
        const messageInput = form.querySelector('textarea[name="message"]');

        if (!nameInput || !emailInput || !phoneInput) {
          alert('Form error. Please refresh the page and try again.');
          return;
        }

        const name = nameInput.value.trim();
        const email = emailInput.value.trim();
        const phone = phoneInput.value.trim();
        const message = messageInput ? messageInput.value.trim() : '';

        // Validation
        if (!name || !email || !phone) {
          alert('Please fill out all required fields.');
          return;
        }

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          alert('Please enter a valid email address.');
          return;
        }

        console.log('[GHL] Data validated, submitting...');

        // Update button
        const btnText = submitBtn?.textContent;
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'Sending...';
        }

        try {
          // Create form data
          const formData = new FormData();
          formData.append('name', name);
          formData.append('email', email);
          formData.append('phone', phone);
          if (message) {
            formData.append('message', message);
          }

          // Submit to HighLevel
          await fetch(FORM_ENDPOINT, {
            method: 'POST',
            body: formData,
            mode: 'no-cors'
          });

          console.log('[GHL] Submission complete');
          alert('Thank you for contacting us! We\'ll respond within 24 hours.');
          form.reset();

        } catch (error) {
          console.error('[GHL] Error:', error);
          alert('Thank you for your message! We\'ll be in touch soon. If you don\'t hear from us, please call (312) 635-5139.');
          form.reset();
        } finally {
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = btnText || 'Send Message';
          }
        }
      });
    }

    // Initialize when ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupContactForm);
    } else {
      setupContactForm();
    }
  })();
</script>
